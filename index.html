<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CryptoFolio</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body class="bg-slate-50 text-slate-900">
  <div class="min-h-screen flex">
    <aside class="w-72 shrink-0 bg-slate-900 text-slate-100 p-5 flex flex-col gap-2 shadow-xl">
      <div class="flex items-center gap-3">
        <div class="size-10 rounded-2xl bg-sky-500/15 grid place-items-center text-sky-300 font-black">CF</div>
        <div>
          <div class="text-lg font-extrabold leading-tight">CryptoFolio</div>
        </div>
      </div>

      <nav class="mt-6 flex flex-col gap-2">
        <button class="nav-btn active" data-v="dash">Dashboard</button>
        <button class="nav-btn" data-v="assets">Assets</button>
        <button class="nav-btn" data-v="ports">Portfolios</button>
      </nav>

      <div class="mt-auto pt-4 border-t border-white/10 text-xs text-slate-400">
        <div class="flex items-center justify-between">
        </div>
      </div>
    </aside>
    <main class="flex-1 min-w-0">
      <header class="sticky top-0 z-10 bg-white/70 backdrop-blur border-b border-slate-200">
        <div class="px-6 py-4 flex items-center justify-between">
          <div>
            <h1 id="pageTitle" class="text-base font-bold">Dashboard</h1>
            <p id="pageHint" class="text-sm text-slate-500">Overview + charts + current prices update.</p>
          </div>


        </div>
      </header>
      <div class="px-6 pt-4">
        <div id="al"></div>
      </div>
      <div class="px-6 py-6 space-y-8">
        <section id="v-dash" class="view">
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="text-sm text-slate-500">Current prices from CoinGecko (USD)</div>
              <div class="text-xs text-slate-400">Click “Prix (API)” to refresh current prices.</div>
            </div>
            <button id="refresh" class="btn-primary">Prix (API)</button>
          </div>

          <div class="grid lg:grid-cols-4 gap-4 mt-4">
            <div class="card">
              <div class="text-sm text-slate-500">Total invested</div>
              <div id="kInv" class="text-3xl font-black mt-1">$0.00</div>
            </div>
            <div class="card">
              <div class="text-sm text-slate-500">Total value (current)</div>
              <div id="kTot" class="text-3xl font-black mt-1">$0.00</div>
            </div>
            <div class="card">
              <div class="text-sm text-slate-500">P/L</div>
              <div id="kPnl" class="text-3xl font-black mt-1">$0.00</div>
              <div id="kPct" class="text-sm text-slate-500 mt-1">0.00%</div>
            </div>
            <div class="card">
              <div class="text-sm text-slate-500">Assets count</div>
              <div id="kCnt" class="text-3xl font-black mt-1">0</div>
              <div class="text-xs text-slate-400 mt-1">Portfolios: <span id="kPorts">0</span></div>
            </div>
          </div>
          <div class="card mt-4">
            <div class="font-bold">Holdings (current value)</div>
            <div class="text-sm text-slate-500">Based on stored quantity × currentPrice (API).</div>

            <div class="mt-4 overflow-auto">
              <table class="w-full text-sm">
                <thead class="sticky top-0 bg-white">
                  <tr class="text-left text-slate-500 border-b">
                    <th class="py-2 pr-2">Asset</th>
                    <th class="py-2 pr-2">Qty</th>
                    <th class="py-2 pr-2">Buy</th>
                    <th class="py-2 pr-2">Current</th>
                    <th class="py-2 pr-2">Value</th>
                    <th class="py-2 pr-2">P/L</th>
                  </tr>
                </thead>
                <tbody id="dashTb"></tbody>
              </table>
            </div>
          </div>
          <div class="grid lg:grid-cols-2 gap-4 mt-4">
            <div class="card">
              <div class="font-bold">Allocation (Bar)</div>
              <div class="text-sm text-slate-500">Value per asset (current).</div>
              <div class="mt-3">
                <canvas id="bar"></canvas>
              </div>
            </div>
            <div class="card">
              <div class="font-bold">Allocation (Pie)</div>
              <div class="text-sm text-slate-500">Relative weight (current).</div>
              <div class="mt-3">
                <canvas id="pie"></canvas>
              </div>
            </div>
          </div>


        </section>
        <section id="v-assets" class="view hidden">
          <div class="grid lg:grid-cols-3 gap-4">

            <div class="card">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-bold">Asset</div>
                  <div class="text-sm text-slate-500">Add / edit an asset.</div>
                </div>
                <span id="assetMode" class="badge">Create</span>
              </div>

              <form id="fA" class="mt-4 space-y-3">
                <input id="aId" type="hidden" />

                <div class="grid grid-cols-2 gap-2">
                  <div>
                    <label class="label">Name</label>
                    <input id="aName" class="input" placeholder="Bitcoin" required />
                  </div>
                  <div>
                    <label class="label">Symbol</label>
                    <input id="aSym" class="input" placeholder="BTC" required />
                  </div>
                </div>

                <div>
                  <label class="label">CoinGecko ID</label>
                  <input id="aCg" class="input" placeholder="bitcoin (required for API)" />
                  <div class="text-xs text-slate-400 mt-1">Ex: bitcoin, ethereum, solana…</div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                  <div>
                    <label class="label">Buy date</label>
                    <input id="aDate" type="date" class="input" />
                  </div>
                  <div>
                    <label class="label">Buy price (USD)</label>
                    <input id="aBuy" type="number" min="0" step="0.01" class="input" placeholder="auto or manual"
                      required />
                  </div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                  <div>
                    <label class="label">Quantity</label>
                    <input id="aQty" type="number" min="0" step="0.00000001" class="input" placeholder="0.25"
                      required />
                  </div>
                  <div>
                    <label class="label">Portfolio</label>
                    <select id="aPort" class="input">
                      <option value="">(No portfolio)</option>
                    </select>
                  </div>
                </div>

                <div class="flex gap-2 pt-2">
                  <button class="btn-primary flex-1" type="submit">Save</button>
                  <button id="aClr" class="btn-secondary" type="button">Clear</button>
                </div>
              </form>
            </div>